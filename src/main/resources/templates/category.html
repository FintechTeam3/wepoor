<!DOCTYPE html>
<html lang="utf-8" xmlns:th="http://www.thymeleaf.org">

<head>
   <!-- basic -->
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <!-- mobile metas -->
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="viewport" content="initial-scale=1, maximum-scale=1">
   <!-- site metas -->
   <title>Teab</title>
   <meta name="keywords" content="">
   <meta name="description" content="">
   <meta name="author" content="">
   <!-- bootstrap css -->
   <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
   <!-- style css -->
   <link rel="stylesheet" type="text/css" href="css/style.css">
   <!-- Responsive-->
   <link rel="stylesheet" href="css/responsive.css">
   <!-- fevicon -->
   <!-- <link rel="icon" href="images/fevicon.png" type="image/gif" /> -->
   <!-- Scrollbar Custom CSS -->
   <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
   <!-- Tweaks for older IEs-->
   <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
   <!-- owl stylesheets -->
   <link rel="stylesheet" href="css/owl.carousel.min.css">
   <link rel="stylesoeet" href="css/owl.theme.default.min.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css"
      media="screen">
    <!-- bootstrap CSS END-->  
    
    <!-- hyejung CSS Start -->
    <link rel="stylesheet" type="text/css" href="css/category.css">
    <!-- hyejung CSS End -->
    
    <!-- 결제 API -->
    <!-- jQuery -->
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<!-- iamport.payment.js -->
	<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
	
</head>


<body>

   <!-- header section start -->
   <div class="header_section">
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
      
         <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup"
            aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
         </button>
         
         <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
            	
            	<!-- user info section -->     
            	<div class="hamburger_userinfo">
	           		<img src="images/whitemywoogeoji.jpg" style="width:60px; height:60px;"/>
	           		<input type="text" class="hamburger_nickname_input" th:value="${userNickname}" readonly>
           		</div>     
            	
            	<hr style="height:2px;border-width:0;background-color:#e0e0e0;" class="mapage_hr">
            	
              	<a class="nav-item nav-link" href="/">Home</a>
              	<a class="nav-item nav-link" href="/mypage">Mypage</a>
               	<a class="nav-item nav-link" href="about.html">About</a>
               	<a class="nav-item nav-link" href="teashop.html">Teashop</a>
               	<a id="logout" class="nav-item nav-link" onclick="logout()">Logout</a>
               	
               	<hr style="height:2px;border-width:0;background-color:#e0e0e0; margin-bottom:1px;" class="mapage_hr">
            </div>
         </div>
         
         <p style="color:white; font-size:35px; font-weight:700; font-family: 'Jua', sans-serif; letter-spacing: 5px;">방목록</p>
         
         <div class="see_bt in_see_bt"><a href="login_page" style="font-size:16px; font-weight:700; font-family: 'Jua', sans-serif; color: black;">My 거지방</a></div>
         
      </nav>
   </div>
   <!-- header section end -->
   
   
   
	<!-- <div class="col-md-6">
		<div th:each="cl:${catelist}" class="box_main active" style="display: flex; justify-content: center;">
		<p th:text="${cl.cate_cost}"></p>		
			<button th:text="${cl.cate_name}" th:onclick="check()" style="background:#CCCCCC; font-size:30px; font-weight:700; font-family: 'Jua', sans-serif; letter-spacing: 5px;">커피</button>
		<span id ="cate_date" th:text="${cl.cate_date}"></span>
		</div>
	</div> -->

   <div class="container">
		<input th:text="${session.userId}" type="hidden" style="display: none;"></input>
		<input th:text="${session.userNo}" type="hidden" style="display: none;"></input>
		<div th:each="cate : ${catelist}">
         <!-- category 값 넘기기 -->
            <ul class="list-group" >
                  <li class="list-group-item" th:onclick="'requestPay(' + ${cate.cate_id} + ');'">
                     <div class="d-flex justify-content-center" style="font-weight: bolder; color: black;">
                        <span th:text="${cate.cate_name}" class="mr-1"></span>
                        <span>거지방</span>
                     </div>
                     <div class="d-flex justify-content-center" style="font-size: 10px; color: #1abc9c;">
                        <span th:text="${#dates.format(cate.start_date, 'MM/dd')}" style="font-weight: bolder;"></span>
                        <span th:text="${#dates.format(cate.end_date, '~ MM/dd')}" style="font-weight: bolder;"></span>
                        <span th:text="${cate.cate_name}" class="mx-1"></span>
                        <span>소비를 5번 참아주세요</span>
                     </div>
                     <div class="d-flex justify-content-center" style="color:red; font-weight: bolder;">
                        <span th:text="${cate.cate_cost}"></span>
                        <span>원</span>
                     </div>
                     <!-- <div th:if="${list.status} == '종료'" class="badge bg-secondary rounded-pill p-1" >
                        <div th:text="${list.status}" style="color:white; font-size:16px; font-weight: bolder; width: 50px;"></div>
                     </div>
                     <div th:if="${list.status} == '진행중'" class="badge bg-success rounded-pill p-1" >
                        <div th:text="${list.status}" style="color:white; font-size:16px; font-weight: bolder; width: 50px;"></div>
                     </div>
                     <div th:if="${list.status} == '시작전'" class="badge bg-danger rounded-pill p-1" >
                        <div th:text="${list.status}" style="color:white; font-size:16px; font-weight: bolder; width: 50px;"></div>
                     </div> -->
                  </li>
            </ul>
         
		</div>
	</div>	
                  
   <!-- copyright section start -->
   <div class="copyright_section">
      <div class="container">
         <p class="copyright_text">Copyright 2023 All Right Reserved By.<a href="https://html.design"> Free html
               Templates</a> Distributed by. <a href="/">life&money</a> </p>
         </p>
      </div>
   </div>
   <!-- copyright section end -->
   
   <input id="ID" type="hidden" th:value="${session.userId}"/>
   <!-- Javascript files-->
   <script src="js/jquery.min.js"></script>
   <script src="js/bootstrap.bundle.min.js"></script>
     <script>
    function roomMake() {
    	window.location.href = 'roomMake'
    }  
    
    
    function logout(){
    	var id = $("#ID").val();
    	console.log(id);
    	
    	if(id.indexOf("@kakao") != -1){
    		$("#logout").prop('href', 'https://kauth.kakao.com/oauth/logout?client_id=e4e9f889e1bb27e6af7af657094f2743&logout_redirect_uri=http://localhost/logout');	
    	
    	}else{
    		
    		$("#logout").prop('href', "logout");
    	}
    	
    	
    }
    
    
    
    
  </script>
</body>

	
	<!-- 결제 API -->
	<script>
		function check(){
			
			var cate_date = $("#cate_date").text();
			
			$.ajax({
			      url: "/roomcheck", // POST 요청을 보낼 엔드포인트 URL
			      type: 'POST',
			      data: { "cate_date": cate_date }, // 전송할 데이터
			      success: function(response) {
			       	
			    	if(response == true){
			    		alert("기간내 하나의 방만 입장가능 합니다.")
			    	}else{
			    		requestPay();
			    	}
			      },
			      error: function(xhr, status, error) {
			        // 요청이 실패하였을 때의 동작
			        console.log('요청이 실패하였습니다.');
			        console.log('에러:', error);
			      }
			      
			    });
			
		};
	
	
		function test() {
			var today = new Date();
			var hour = String(today.getHours());
			var minute = String(today.getMinutes());
			var second = String(today.getSeconds());
			var millisecond = String(today.getMilliseconds());
			var merchantID = hour + minute + second + millisecond;
			console.log(merchantID);
			
			var userID = $("#ID").val();
			console.log(userID);
			
		}	
	
      // cate_id가 number로 들어감
		function requestPay(number) {
			// 객체 초기화
			const IMP = window.IMP;
			IMP.init("imp47603282");
			
			var today = new Date();
			var hour = today.getHours();
			var minute = today.getMinutes();
			var second = today.getSeconds();
			var millisecond = today.getMilliseconds();
			var merchantID = hour + minute + second + millisecond;
			
			var userID = $("#ID").val();
			
			IMP.request_pay({
				pg: 'html5_inicis',
				pay_method : 'card',
				merchant_uid: "order_no_" + merchantID,
				buyer_name : userID,
				amount : 50000
			}, function(rsp) {
				if (rsp.success) {
					confirm('결제완료');
				} else {
					confirm('결제실패');
				}
			})
		};
	</script>
</html>